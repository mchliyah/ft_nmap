#include "../include/ft_nmap.h"


// Common UDP payloads
const uint8_t dns_query[] = {
    0x12, 0x34, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 'w', 'w', 'w',
    0x06, 'g', 'o', 'o', 'g', 'l', 'e', 0x03, 'c', 'o', 'm',
    0x00, 0x00, 0x01, 0x00, 0x01
};

const uint8_t snmp_query[] = {
    0x30, 0x26, 0x02, 0x01, 0x00, 0x04, 0x06, 0x70,
    0x75, 0x62, 0x6c, 0x69, 0x63, 0xA0, 0x19, 0x02,
    0x01, 0x01, 0x02, 0x01, 0x00, 0x02, 0x01, 0x00,
    0x30, 0x0E, 0x30, 0x0C, 0x06, 0x08, 0x2B, 0x06,
    0x01, 0x02, 0x01, 0x01, 0x01, 0x00, 0x05, 0x00
};

const uint8_t ntp_query[] = {
    0xE3, 0x00, 0x04, 0xFA, 0x00, 0x01, 0x00, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t netbios_query[] = {
    0x80, 0x94, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x20, 0x43, 0x4B, 0x41,
    0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
    0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
    0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
    0x41, 0x41, 0x41, 0x41, 0x41, 0x00, 0x00, 0x21,
    0x00, 0x01
};

const uint8_t sip_options[] = {
    'O', 'P', 'T', 'I', 'O', 'N', 'S', ' ',
    's', 'i', 'p', ':', 'e', 'x', 'a', 'm',
    'p', 'l', 'e', '@', 'e', 'x', 'a', 'm',
    'p', 'l', 'e', '.', 'c', 'o', 'm', ' ',
    'S', 'I', 'P', '/', '2', '.', '0', '\r',
    '\n', 'V', 'i', 'a', ':', ' ', 'S', 'I',
    'P', '/', '2', '.', '0', '/', 'U', 'D',
    'P', ' ', 'e', 'x', 'a', 'm', 'p', 'l',
    'e', '.', 'c', 'o', 'm', ';', 'b', 'r',
    'a', 'n', 'c', 'h', '=', 'z', '9', 'h',
    'G', '4', 'b', 'K', '\r', '\n', 'M', 'a',
    'x', '-', 'F', 'o', 'r', 'w', 'a', 'r',
    'd', 's', ':', ' ', '7', '0', '\r', '\n',
    'F', 'r', 'o', 'm', ':', ' ', '<', 's',
    'i', 'p', ':', 'e', 'x', 'a', 'm', 'p',
    'l', 'e', '@', 'e', 'x', 'a', 'm', 'p',
    'l', 'e', '.', 'c', 'o', 'm', '>', ';',
    't', 'a', 'g', '=', '1', '2', '3', '4',
    '5', '\r', '\n', 'T', 'o', ':', ' ', '<',
    's', 'i', 'p', ':', 'e', 'x', 'a', 'm',
    'p', 'l', 'e', '@', 'e', 'x', 'a', 'm',
    'p', 'l', 'e', '.', 'c', 'o', 'm', '>',
    '\r', '\n', 'C', 'a', 'l', 'l', '-', 'I',
    'D', ':', ' ', 'a', 'b', 'c', 'd', 'e',
    'f', 'g', '\r', '\n', 'C', 'S', 'e', 'q',
    ':', ' ', '1', ' ', 'O', 'P', 'T', 'I',
    'O', 'N', 'S', '\r', '\n', 'C', 'o', 'n',
    't', 'a', 'c', 't', ':', ' ', '<', 's',
    'i', 'p', ':', 'e', 'x', 'a', 'm', 'p',
    'l', 'e', '@', 'e', 'x', 'a', 'm', 'p',
    'l', 'e', '.', 'c', 'o', 'm', '>', '\r',
    '\n', 'A', 'c', 'c', 'e', 'p', 't', ':',
    ' ', 'a', 'p', 'p', 'l', 'i', 'c', 'a',
    't', 'i', 'o', 'n', '/', 's', 'd', 'p',
    '\r', '\n', 'C', 'o', 'n', 't', 'e', 'n',
    't', '-', 'L', 'e', 'n', 'g', 't', 'h',
    ':', ' ', '0', '\r', '\n', '\r', '\n'
};

// TFTP read request for filename "default"
const uint8_t tftp_read_request[] = {
    0x00, 0x01, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6C,
    0x74, 0x00, 0x6F, 0x63, 0x74, 0x65, 0x74, 0x00
};

// RPC portmap request
const uint8_t rpc_portmap_request[] = {
    0x80, 0x00, 0x00, 0x28, 0x6F, 0xFD, 0x73, 0x5F,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
    0x00, 0x01, 0x86, 0xA0, 0x00, 0x00, 0x00, 0x04,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


static const udp_payload_t udp_payloads[] = {
    {53,   "domain",   dns_query,          sizeof(dns_query)},
    {69,   "tftp",     tftp_read_request,  sizeof(tftp_read_request)},
    {111,  "rpcbind",  rpc_portmap_request,sizeof(rpc_portmap_request)},
    {161,  "snmp",     snmp_query,         sizeof(snmp_query)},
    {123,  "ntp",      ntp_query,          sizeof(ntp_query)},
    {137,  "netbios",  netbios_query,      sizeof(netbios_query)},
    {5060, "sip",      sip_options,        sizeof(sip_options)},
    {0,    NULL,       NULL,               0}
};

const udp_payload_t *get_udp_payload(uint16_t port) {
    for (int i = 0; udp_payloads[i].port != 0; i++) {
        if (udp_payloads[i].port == port) {
            return &udp_payloads[i];
        }
    }
    return NULL;
}
